<?xml version="1.0" encoding="utf-8"?>
<modification>
    <name>super_offers</name>
    <code>super_offers</code>
    <description>Комбинации опций</description>
    <version>1.0.0</version>
    <author>PRO Hamster</author>
    <link>http://prohamster.com</link>

    <file path="admin/controller/catalog/product.php">
        <operation error="skip">
            <search><![CDATA[if (($this->request->server['REQUEST_METHOD'] == 'POST') && $this->validateForm()) {]]></search>
            <add position="before"><![CDATA[
                // SUPER OFFERS START
                if ((in_array(__FUNCTION__, array('edit')))
                && ($this->request->server['REQUEST_METHOD'] == 'POST') && isset($this->request->get['so_save'])
                && file_exists(DIR_SYSTEM.'library/pro_hamster/extension/super_offers.json')) {

                    if (!$this->validateForm()) {
                        $json_ = array();
                        $json_['error'] = (isset($this->error['warning']))
                            ? $this->error['warning'] : $this->language->get('error_warning');
                        return $this->response->setOutput(json_encode($json_));
                    }
                }
                // SUPER OFFERS END
            ]]></add>
        </operation>
    </file>

    <file path="system/library/cart/cart.php">
        <operation error="skip">
            <search><![CDATA[$this->db = $registry->get('db');]]></search>
            <add position="after"><![CDATA[
                // SUPER OFFERS START
                if ((in_array(__FUNCTION__, array('__construct'))) && !isset($this->super_offers)
                && file_exists(DIR_SYSTEM.'library/pro_hamster/extension/super_offers.json')) {
                    $this->super_offers = new \super_offers($registry);
                }
                // SUPER OFFERS END
            ]]></add>
        </operation>
    </file>

    <file path="system/library/cart/cart.php">
        <operation error="skip">
            <search><![CDATA[return $product_data;]]></search>
            <add position="before"><![CDATA[
                // SUPER OFFERS START
                if ((in_array(__FUNCTION__, array('getProducts'))) && isset($this->super_offers)
                && file_exists(DIR_SYSTEM.'library/pro_hamster/extension/super_offers.json')) {
                    $product_data = $this->super_offers->fixProducts($product_data);
                }
                // SUPER OFFERS END
            ]]></add>
        </operation>
    </file>

</modification>
